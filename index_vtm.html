<html>
    <head>
        <script src="https://d3js.org/d3.v6.min.js"></script>
        <script src="https://rawcdn.githack.com/Kcnarf/d3-weighted-voronoi/v1.1.3/build/d3-weighted-voronoi.js"></script>
        <script src="https://rawcdn.githack.com/Kcnarf/d3-voronoi-map/v2.1.1/build/d3-voronoi-map.js"></script>
        <script src="https://rawcdn.githack.com/Kcnarf/d3-voronoi-treemap/v1.1.2/build/d3-voronoi-treemap.js"></script> 
        <style>

        </style>
    </head>

    <body>
        <div id="visualization">
            
        </div>

        <script>
            console.log(d3); // test if d3 is loaded

            var width = 800; 
            var height = 800;
            var margin = {top: 0, left: 0};

            const svg = d3.select("div#visualization")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // create space for the labels (dots)
            const labels = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            let data = d3.csv("data/Tricorache et al_Global trade dataset for cheetah.csv", d3.autoType).then(function(data) {
                console.log(data);
            })

            // create hierarchy of data
            const hierarchy = d3.hierarchy({children: data})
                .sum(d => d.Cheetahs);

            console.log(hierarchy);

            // tree map will be clipped in a circle
            circle = d3
                .range(100)
                .map(i => [
                    (width * (1 + Math.cos((i / 50) * Math.PI))) / 2,
                    (height * (1 + Math.sin((i / 50) * Math.PI))) / 2
                ])

            let voronoiTreeMap = d3.voronoiTreemap()
                .clip(circle);
                
            voronoiTreeMap(hierarchy);

            // create nodes for VTM
            let allNodes = hierarchy.descendants()
                    .sort((a, b) => b.depth - a.depth)
                    .map((d, i) => Object.assign({}, d, {id: i}));
            
            console.log(allNodes);
                
            // create voronoi cells
            svg.selectAll('path')
                .data(allNodes)
                .enter()
                .append('path')
                .attr('d', d => "M" + d.polygon.join("L") + "Z")
                .style('fill', "white")
                .attr("stroke", "black")
                .attr("stroke-width", 1)
                .style('fill-opacity', d => d.depth === 2 ? 1 : 0);

        </script>
    </body>
</html>